import PrereqCloud from '/snippets/prerequisites/_prereqs-cloud-only.mdx';
import LivesyncLimitations from '/snippets/integrations/_livesync-limitations.mdx';
import ConfigureSourceDatabasePostgres from '/snippets/integrations/_configure-source-database-postgres.mdx';
import ConfigureSourceDatabaseAWSRDS from '/snippets/integrations/_configure-source-database-awsrds.mdx';
import { SERVICE_SHORT, SERVICE_LONG, PG, PG_CONNECTOR, CONSOLE, HYPERTABLE } from '/snippets/vars.mdx';

## Prerequisites

<PrereqCloud />

- Install the [{PG} client tools](/integrations/integrate/psql) on your sync machine.

- Ensure that the source {PG} instance and the target {SERVICE_LONG} have the same extensions installed.

  The {PG_CONNECTOR} does not create extensions on the target. If the table uses column types from an extension,
    first create the extension on the target {SERVICE_LONG} before syncing the table.

## Limitations

* The source {PG} instance must be accessible from the Internet.

  Services hosted behind a firewall or VPC are not supported. This functionality is on the roadmap.

* Indexes, including the primary key and unique constraints, are not migrated to the target.

  We recommend that, depending on your query patterns, you create only the necessary indexes on the target.

<LivesyncLimitations />

## Set your connection string

This variable holds the connection information for the source database. In the terminal on your migration machine,
set the following:

```bash
export SOURCE="postgres://<user>:<password>@<source host>:<source port>/<db_name>"
```

<Warning>
Avoid using connection strings that route through connection poolers like PgBouncer or similar tools. This tool
requires a direct connection to the database to function properly.
</Warning>

## Tune your source database

<Tabs>

<Tab title="From AWS RDS/Aurora">

<ConfigureSourceDatabaseAWSRDS />

</Tab>

<Tab title="From Postgres">

<ConfigureSourceDatabasePostgres />

</Tab>

</Tabs>

## Synchronize data to your Tiger Cloud service

To sync data from your {PG} database using {CONSOLE}:

1. **Connect to your {SERVICE_SHORT}**

   In [{CONSOLE}][console-services], select the {SERVICE_SHORT} to sync live data to.

2. **Connect the source database and the target {SERVICE_SHORT}**

   ![Postgres connector wizard](https://assets.timescale.com/docs/images/tiger-on-azure/pg-connector-wizard-tiger-console.png)

   1. Click `Connectors` > `PostgreSQL`.
   2. Set the name for the new connector by clicking the pencil icon.
   3. Check the boxes for `Set wal_level to logical` and `Update your credentials`, then click `Continue`.
   4. Enter your database credentials or a {PG} connection string, then click `Connect to database`.
      This is the connection string for `<pg connector username>`. The console connects to the source database and retrieves the schema information.

3. **Optimize the data to synchronize in hypertables**

   ![Postgres connector start](https://assets.timescale.com/docs/images/tiger-on-azure/pg-connector-start-tiger-console.png)

   1. In the `Select table` dropdown, select the tables to sync.
   2. Click `Select tables +`.

      The console checks the table schema and, if possible, suggests the column to use as the time dimension in a {HYPERTABLE}.
   3. Click `Create Connector`.

      The console starts the connector between the source database and the target {SERVICE_SHORT} and displays the progress.

4. **Monitor synchronization**

   ![Connectors overview](https://assets.timescale.com/docs/images/tiger-on-azure/tiger-console-connector-overview.png)

    1. To view the amount of data replicated, click `Connectors`. The diagram in `Connector data flow` gives you an overview of the connectors you have created, their status, and how much data has been replicated.

    2. To review the syncing progress for each table, click `Connectors` > `Source connectors`, then select the name of your connector in the table.

5. **Manage the connector**

   ![Edit a Postgres connector](https://assets.timescale.com/docs/images/tiger-on-azure/edit-pg-connector-tiger-console.png)

   1. To edit the connector, click `Connectors` > `Source connectors`, then select the name of your connector in the table. You can rename the connector, delete or add new tables for syncing.

   2. To pause a connector, click `Connectors` > `Source connectors`, then open the three-dot menu on the right and select `Pause`.

   3. To delete a connector, click `Connectors` > `Source connectors`, then open the three-dot menu on the right and select `Delete`. You must pause the connector before deleting it.

And that is it, you are using the connector to synchronize all the data, or specific tables, from a {PG} database
instance in real time.

[console-services]: https://console.cloud.timescale.com/dashboard/services
