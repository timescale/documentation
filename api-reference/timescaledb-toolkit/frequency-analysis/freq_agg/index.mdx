---
title: Frequency aggregation overview
sidebarTitle: Overview
description: Functions for finding the most common values using the SpaceSaving algorithm
topics: [hyperfunctions]
license: community
toolkit: true
products: [cloud, mst, self_hosted]
---

<Icon icon="flask" /> Early access 1.5.0

Get the most common elements of a set and their relative frequency. The estimation uses the SpaceSaving algorithm.

This group of functions contains two aggregate functions, which let you set the cutoff for keeping track of a value in different ways. [`freq_agg`](#freq_agg) allows you to specify a minimum frequency, and [`mcv_agg`](#mcv_agg) allows you to specify the target number of values to keep.

To estimate the absolute number of times a value appears, use [`count_min_sketch`][count_min_sketch].

import TwoStepAggregation from '/snippets/api-reference/timescaledb/hyperfunctions/_two-step-aggregation.mdx';

## Two-step aggregation

<TwoStepAggregation />

## Samples

### Get the 5 most common values from a table

This test uses a table of randomly generated data. The values used are the integer square roots of a random number in
the range 0 to 400.

```sql
CREATE TABLE value_test(value INTEGER);
INSERT INTO value_test SELECT floor(sqrt(random() * 400)) FROM generate_series(1,100000);
```

This returns the 5 most common values seen in the table:

```sql
SELECT topn(
    toolkit_experimental.freq_agg(0.05, value),
    5)
FROM value_test;
```

The output for this query:

```sql
 topn
------
   19
   18
   17
   16
   15
```

### Generate a table with frequencies of the most commonly seen values

Return values that represent more than 5% of the input:

```sql
SELECT value, min_freq, max_freq
FROM into_values(
    (SELECT toolkit_experimental.freq_agg(0.05, value) FROM value_test));
```

The output for this query looks like this, with some variation due to randomness:

```sql
 value | min_freq | max_freq
-------+----------+----------
    19 |  0.09815 |  0.09815
    18 |  0.09169 |  0.09169
    17 |  0.08804 |  0.08804
    16 |  0.08248 |  0.08248
    15 |  0.07703 |  0.07703
    14 |  0.07157 |  0.07157
    13 |  0.06746 |  0.06746
    12 |  0.06378 |  0.06378
    11 |  0.05565 |  0.05595
    10 |  0.05286 |  0.05289
```

## Available functions

### Aggregates
- [`freq_agg()`][freq_agg]: aggregate data into a space-saving aggregate with a minimum frequency cutoff
- [`mcv_agg()`][mcv_agg]: aggregate data into a space-saving aggregate with a target number of values

### Accessors
- [`into_values()`][into_values]: return the values and their estimated frequencies from a frequency aggregate
- [`max_frequency()`][max_frequency]: get the maximum frequency of a value from a frequency aggregate
- [`min_frequency()`][min_frequency]: get the minimum frequency of a value from a frequency aggregate
- [`topn()`][topn]: get the N most common values from a frequency aggregate

### Rollup
- [`rollup()`][rollup]: combine multiple frequency aggregates

[two-step-aggregation]: #two-step-aggregation
[count_min_sketch]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/count_min_sketch/index
[freq_agg]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/freq_agg
[mcv_agg]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/mcv_agg
[into_values]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/into_values
[max_frequency]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/max_frequency
[min_frequency]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/min_frequency
[topn]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/topn
[rollup]: /api-reference/timescaledb/hyperfunctions/frequency-analysis/freq_agg/rollup
