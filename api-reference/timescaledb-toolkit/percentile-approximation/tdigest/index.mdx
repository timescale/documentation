---
title: t-digest overview
sidebarTitle: Overview
description: Percentile approximation optimized for extreme quantiles using the t-digest algorithm
topics: [hyperfunctions]
license: community
toolkit: true
products: [cloud, mst, self_hosted]
---

<Icon icon="circle-play" iconType="duotone" /> Since 1.0.0

Estimate the value at a given percentile, or the percentile rank of a given value, using the t-digest algorithm. This
estimation is more memory- and CPU-efficient than an exact calculation using PostgreSQL's `percentile_cont` and
`percentile_disc` functions.

`tdigest` is one of two advanced percentile approximation aggregates provided in TimescaleDB Toolkit. It is a
space-efficient aggregation, and it provides more accurate estimates at extreme quantiles than traditional methods.

`tdigest` is somewhat dependent on input order. If `tdigest` is run on the same data arranged in different order, the
results should be nearly equal, but they are unlikely to be exact.

The other advanced percentile approximation aggregate is [`uddsketch`][uddsketch], which produces stable estimates
within a guaranteed relative error. If you aren't sure which to use, try the default percentile estimation method,
[`percentile_agg`][percentile_agg]. It uses the `uddsketch` algorithm with some sensible defaults.

import TwoStepAggregation from '/snippets/api-reference/timescaledb/hyperfunctions/two-step-aggregation.mdx';

## Two-step aggregation

<TwoStepAggregation />

## Samples

### Aggregate and roll up percentile data to calculate daily percentiles

Create an hourly continuous aggregate that contains a percentile aggregate:

```sql
CREATE MATERIALIZED VIEW foo_hourly
WITH (timescaledb.continuous)
AS SELECT
    time_bucket('1 h'::interval, ts) AS bucket,
    tdigest(100, value) AS tdigest
FROM foo
GROUP BY 1;
```

Use accessors to query directly from the continuous aggregate for hourly data. You can also roll the hourly data up into
daily buckets, then calculate approximate percentiles:

```sql
SELECT
    time_bucket('1 day'::interval, bucket) AS bucket,
    approx_percentile(0.95, rollup(tdigest)) AS p95,
    approx_percentile(0.99, rollup(tdigest)) AS p99
FROM foo_hourly
GROUP BY 1;
```

## Available functions

### Aggregate
- [`tdigest()`][tdigest]: aggregate data in a t-digest for percentile calculation

### Accessors
- [`approx_percentile()`][approx_percentile]: estimate the value at a given percentile from a t-digest
- [`approx_percentile_rank()`][approx_percentile_rank]: estimate the percentile rank of a given value from a t-digest
- [`max_val()`][max_val]: get the maximum value from a t-digest
- [`mean()`][mean]: calculate the exact mean from values in a t-digest
- [`min_val()`][min_val]: get the minimum value from a t-digest
- [`num_vals()`][num_vals]: get the number of values in a t-digest

### Rollup
- [`rollup()`][rollup]: combine multiple t-digest aggregates

[two-step-aggregation]: #two-step-aggregation
[uddsketch]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/uddsketch/index
[percentile_agg]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/uddsketch/percentile_agg
[tdigest]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/tdigest
[approx_percentile]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/approx_percentile
[approx_percentile_rank]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/approx_percentile_rank
[max_val]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/max_val
[mean]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/mean
[min_val]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/min_val
[num_vals]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/num_vals
[rollup]: /api-reference/timescaledb/hyperfunctions/percentile-approximation/tdigest/rollup