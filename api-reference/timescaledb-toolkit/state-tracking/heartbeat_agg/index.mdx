---
title: Heartbeat aggregation overview
sidebarTitle: Overview
description: Determine system liveness from timestamped heartbeats with heartbeat_agg functions
---

<Icon icon="circle-play" iconType="duotone" /> Since 1.15.0

Determine the overall liveness of a system from a series of timestamped heartbeats and a liveness interval. This aggregate can be used to report total uptime or downtime as well as report the time ranges where the system was live or dead.

You can combine multiple heartbeat aggregates to determine the overall health of a service. For example, the heartbeat aggregates from a primary and standby server could be combined to see if there was ever a window where both machines were down at the same time.

## Two-step aggregation

This group of functions uses the two-step aggregation pattern.

Rather than calculating the final result in one step, you first create an intermediate aggregate by using the aggregate function.

Then, use any of the accessors on the intermediate aggregate to calculate a final result. You can also roll up multiple intermediate aggregates with the rollup functions.

The two-step aggregation pattern has several advantages:

1.  More efficient because multiple accessors can reuse the same aggregate
1.  Easier to reason about performance, because aggregation is separate from final computation
1.  Easier to understand when calculations can be rolled up into larger intervals, especially in window functions and [continuous aggregates][caggs]
1.  Can perform retrospective analysis even when underlying data is dropped, because the intermediate aggregate stores extra information not available in the final result

To learn more, see the [blog post on two-step aggregates][blog-two-step-aggregates].

## Functions in this group

### Aggregate
- [`heartbeat_agg()`][heartbeat_agg]: aggregate heartbeat data into an intermediate form for further computation

### Accessors
- [`uptime()`][uptime]: get the total uptime from the aggregate
- [`downtime()`][downtime]: get the total downtime from the aggregate
- [`interpolated_uptime()`][interpolated_uptime]: get the total uptime, interpolating values at the boundary
- [`interpolated_downtime()`][interpolated_downtime]: get the total downtime, interpolating values at the boundary
- [`live_at()`][live_at]: determine if the system was live at a given time
- [`live_ranges()`][live_ranges]: get all time ranges when the system was live
- [`dead_ranges()`][dead_ranges]: get all time ranges when the system was dead
- [`num_live_ranges()`][num_live_ranges]: count the number of live ranges
- [`num_gaps()`][num_gaps]: count the number of gaps (downtime periods)
- [`trim_to()`][trim_to]: trim the aggregate to a specific time range

### Mutator
- [`interpolate()`][interpolate]: interpolate the state at interval boundaries

### Rollup
- [`rollup()`][rollup]: combine multiple intermediate aggregates

[two-step-aggregation]: #two-step-aggregation
[blog-two-step-aggregates]: https://www.timescale.com/blog/how-postgresql-aggregation-works-and-how-it-inspired-our-hyperfunctions-design
[caggs]: /use-timescale/continuous-aggregates/about-continuous-aggregates/
[heartbeat_agg]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/heartbeat_agg
[uptime]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/uptime
[downtime]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/downtime
[interpolated_uptime]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/interpolated_uptime
[interpolated_downtime]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/interpolated_downtime
[live_at]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/live_at
[live_ranges]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/live_ranges
[dead_ranges]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/dead_ranges
[num_live_ranges]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/num_live_ranges
[num_gaps]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/num_gaps
[trim_to]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/trim_to
[interpolate]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/interpolate
[rollup]: /api-reference/timescaledb/hyperfunctions/state-tracking/heartbeat_agg/rollup
