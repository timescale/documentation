---
title: state_agg()
description: Aggregate state data into a state aggregate for further analysis
license: community
type: function
toolkit: true
topics: [hyperfunctions]
hyperfunction:
  family: state tracking
  type: aggregate
  aggregates:
    - state_agg()
---

<Icon icon="circle-play" iconType="duotone" /> Since 1.15.0

Aggregate state data into a state aggregate to track state transitions. Unlike [`compact_state_agg`][compact_state_agg], which only stores durations, `state_agg` also stores the timestamps of state transitions.

```sql
state_agg(
  ts TIMESTAMPTZ,
  value {TEXT | BIGINT}
) RETURNS StateAgg
```

## Arguments

| Name | Type | Default | Required | Description |
|------|------|---------|----------|-------------|
| ts | TIMESTAMPTZ | - | ✔ | Timestamps associated with each state reading |
| value | TEXT \| BIGINT | - | ✔ | The state at that time |

## Returns

| Column | Type | Description |
|--------|------|-------------|
| agg | StateAgg | An object storing the periods spent in each state, including timestamps of state transitions |

## Samples

Create a state aggregate to track the status of some devices.

```sql
SELECT state_agg(time, status) FROM devices;
```

[compact_state_agg]: /api-reference/timescaledb/hyperfunctions/state-tracking/compact_state_agg/
