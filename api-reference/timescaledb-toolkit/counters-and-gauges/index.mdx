---
title: Counters and gauges overview
sidebarTitle: Overview
description: Functions for analyzing monotonic counters and gauge metrics
topics: [hyperfunctions]
license: community
toolkit: true
products: [cloud, mst, self_hosted]
---

<Icon icon="circle-play" iconType="duotone" /> Since 1.3.0

Analyze counter and gauge metrics commonly found in monitoring and observability systems. These functions help you
calculate rates, deltas, and trends from time-series measurements.

-  **Counters**: Analyze data whose values are designed to monotonically increase, with any decreases treated as resets
  (for example, request counts, bytes sent)
- **Gauges**: Analyze data that can both increase and decrease (for example, temperature, memory usage, queue depth)

import TwoStepAggregation from '/snippets/api-reference/timescaledb/hyperfunctions/two-step-aggregation.mdx';

## Two-step aggregation

<TwoStepAggregation />

## Samples

### Calculate counter delta and rate

Create daily counter aggregates and calculate the change over each day:

```sql
WITH daily_counters AS (
    SELECT
        date_trunc('day', ts) AS day,
        counter_agg(ts, requests) AS counter_summary
    FROM metrics
    WHERE service_id = 'api-server'
    GROUP BY day
)
SELECT
    day,
    delta(counter_summary) AS daily_requests,
    rate(counter_summary) AS avg_requests_per_second
FROM daily_counters
ORDER BY day;
```

### Calculate gauge statistics

Analyze gauge metrics to understand trends and variability:

```sql
WITH hourly_gauges AS (
    SELECT
        time_bucket('1 hour'::interval, ts) AS hour,
        gauge_agg(ts, memory_usage) AS gauge_summary
    FROM system_metrics
    WHERE host = 'web-01'
    GROUP BY hour
)
SELECT
    hour,
    delta(gauge_summary) AS memory_change,
    rate(gauge_summary) AS memory_change_rate
FROM hourly_gauges
ORDER BY hour;
```

### Roll up and extrapolate counter values

Roll up hourly counter aggregates into daily summaries and extrapolate rates:

```sql
WITH hourly AS (
    SELECT
        time_bucket('1 hour'::interval, ts) AS hour,
        counter_agg(ts, bytes_sent, tstzrange('2024-01-01', '2024-01-02')) AS cs
    FROM network_metrics
    GROUP BY hour
),
daily AS (
    SELECT
        date_trunc('day', hour) AS day,
        rollup(cs) AS daily_cs
    FROM hourly
    GROUP BY day
)
SELECT
    day,
    extrapolated_delta(daily_cs, '1 day'::interval) AS estimated_total_bytes,
    extrapolated_rate(daily_cs, '1 day'::interval) AS estimated_avg_bytes_per_sec
FROM daily;
```

## Available functions

### Counter aggregation
- [`counter_agg()`][counter_agg]: analyze monotonically increasing counter metrics

### Gauge aggregation
- [`gauge_agg()`][gauge_agg]: analyze gauge metrics that can increase or decrease

[two-step-aggregation]: #two-step-aggregation
[counter_agg]: /api-reference/timescaledb/hyperfunctions/counters-and-gauges/counter_agg/index
[gauge_agg]: /api-reference/timescaledb/hyperfunctions/counters-and-gauges/gauge_agg/index
