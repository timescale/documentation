---
title: add_columnstore_policy()
description: set a policy to automatically move chunks in a hypertable to the columnstore when they reach a given age.
license: community
type: procedure
topics: [hypercore, columnstore, jobs]
keywords: [columnstore, hypercore, policies]
tags: [scheduled jobs, background jobs, automation framework]
products: [cloud, mst, self_hosted]
---

import OldCreateHypertable from '/snippets/api-reference/timescaledb/hypercore/_old-api-create-hypertable.mdx';
import CreateHypertablePolicyNote from
'/snippets/api-reference/timescaledb/hypercore/_create-hypertable-columnstore-policy-note.mdx';
import { COLUMNSTORE, ROWSTORE, TIMESCALE_DB, CHUNK, HYPERTABLE, CAGG } from '/snippets/vars.mdx';

<Icon icon="circle-play" iconType="duotone" /> Since 2.18.0

Create a [job][job] that automatically moves {CHUNK}s in a {HYPERTABLE} to the {COLUMNSTORE} after a
specific time interval.

- **Continuous aggregates**:

   You first call `ALTER MATERIALIZED VIEW` to enable the {COLUMNSTORE} on a {CAGG}, then create the job that converts
   your data to the {COLUMNSTORE} with a call to `add_columnstore_policy`.

- **Hypertables**:

   <CreateHypertablePolicyNote />

When {COLUMNSTORE} is enabled, [bloom filters][bloom-filters] are enabled by default, and every new {CHUNK} has a bloom
index.
Bloom indexes are not retrofitted, existing {CHUNK}s need to be fully recompressed to have the bloom indexes present. If
you converted {CHUNK}s to {COLUMNSTORE} using {TIMESCALE_DB} [v2.19.3](tsdb-release-2-19-3) or below, to enable bloom filters on that data you have
to convert those {CHUNK}s to the {ROWSTORE}, then convert them back to the {COLUMNSTORE}.

To view the policies that you set or the policies that already exist, see [informational views][informational-views].

A {COLUMNSTORE} policy is applied on a per-{CHUNK} basis. If you remove an existing policy and then add a new one, the
new
policy applies only to the {CHUNK}s that have not yet been converted to {COLUMNSTORE}. The existing {CHUNK}s in the
{COLUMNSTORE} remain unchanged. This means that {CHUNK}s with different {COLUMNSTORE} settings can co-exist in the same
{HYPERTABLE}.

## Samples

To create a {COLUMNSTORE} job:

- **Enable {COLUMNSTORE}**

    For [efficient queries][secondary-indexes] on data in the columnstore, remember to `segmentby` the column you will
    use most often to filter your data.
    * [Use `ALTER MATERIALIZED VIEW` for a {CAGG}][compression_continuous-aggregate]
      ```sql
      ALTER MATERIALIZED VIEW assets_candlestick_daily SET (
         timescaledb.enable_columnstore = true,
         timescaledb.segmentby = 'symbol');
      ```

   * [Use `CREATE TABLE` for a {HYPERTABLE}][hypertable-create-table]. The columnstore policy is created automatically.

     ```sql
     CREATE TABLE crypto_ticks (
        "time" TIMESTAMPTZ,
        symbol TEXT,
        price DOUBLE PRECISION,
        day_volume NUMERIC
     ) WITH (
       tsdb.hypertable,
       tsdb.segmentby='symbol',
       tsdb.orderby='time DESC'
     );
     ```
     <OldCreateHypertable />

- **Add a policy to move {CHUNK}s to the {COLUMNSTORE} at a specific time interval**

   For example:

   * 60 days after the data was added to the table:
     ``` sql
     CALL add_columnstore_policy('crypto_ticks', after => INTERVAL '60d');
     ```
   * 3 months prior to the moment you run the query:

     ``` sql
     CALL add_columnstore_policy('crypto_ticks', created_before => INTERVAL '3 months');
     ```
   * With an integer-based time column:

     ``` sql
     CALL add_columnstore_policy('table_with_bigint_time', BIGINT '600000');
     ```
   * Older than eight weeks:

     ``` sql
     CALL add_columnstore_policy('cpu_weekly', INTERVAL '8 weeks');
     ```

   * Control the time your policy runs:

      When you use a policy with a fixed schedule, {TIMESCALE_DB} uses the `initial_start` time to compute the
      next start time. When {TIMESCALE_DB} finishes executing a policy, it picks the next available time on the
     schedule,
      skipping any candidate start times that have already passed.

      When you set the `next_start` time, it only changes the start time of the next immediate execution. It does not
      change the computation of the next scheduled execution after that next execution. To change the schedule so a
      policy starts at a specific time, you need to set `initial_start`. To change the next immediate
      execution, you need to set `next_start`. For example, to modify a policy to execute on a fixed schedule 15 minutes
      past the hour, and every
      hour, you need to set both `initial_start` and `next_start` using `alter_job`:

      ``` sql
      select * from alter_job(1000, fixed_schedule => true, initial_start => '2025-07-11 10:15:00', next_start =>
     '2025-07-11 11:15:00');
      ```


- **View the policies that you set or the policies that already exist**

   ``` sql
   SELECT * FROM timescaledb_information.jobs
   WHERE proc_name='policy_compression';
   ```
   See [timescaledb_information.jobs][informational-views].



## Arguments

The syntax is:

```sql
CALL add_columnstore_policy(
    hypertable = '<hypertable_name>',
    after = <interval>,
    if_not_exists = true | false,
    schedule_interval = <interval>,
    initial_start = <timestamptz>,
    timezone = '<timezone>',
    created_before = <interval>
);
```

Calls to `add_columnstore_policy` require either `after` or `created_before`, but cannot have both.

| Name                          | Type | Default                                                                                                                      | Required | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-------------------------------|--|------------------------------------------------------------------------------------------------------------------------------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `hypertable`                  |REGCLASS| -                                                                                                                            | ✔        | Name of the {HYPERTABLE} or {CAGG} to run this [job][job] on.                                                                                                                                                                                                                                                                                                                                                                                                  |
| `after`                       |INTERVAL or INTEGER| -                                                                                                                            | ✖        | Add {CHUNK}s containing data older than `now - {after}::interval` to the {COLUMNSTORE}. <br/> Use an object type that matchs the time column type in `hypertable`: <ul><li><b><code>TIMESTAMP</code>, <code>TIMESTAMPTZ</code>, or <code>DATE</code></b>: use an <code>INTERVAL</code> type.</li><li><b> Integer-based timestamps </b>: set an integer type using the [integer_now_func][set_integer_now_func].</li></ul> `after` is mutually exclusive with `created_before`. |
| `created_before`              |INTERVAL| NULL                                                                                                                         | ✖        | Add {CHUNK}s with a creation time of `now() - created_before` to the {COLUMNSTORE}. <br/> `created_before` is <ul><li>Not supported for {CAGG}s.</li><li>Mutually exclusive with `after`.</li></ul>                                                                                                                                                                                                                                                                             |
| `schedule_interval`           |INTERVAL| 12 hours when [chunk_time_interval][chunk_time_interval] >= `1 day` for `hypertable`. Otherwise `chunk_time_interval` / `2`. | ✖        | Set the interval between the finish time of the last execution of this policy and the next start.                                                                                                                                                                                                                                                                                                                                                                          |
| `initial_start`               |TIMESTAMPTZ| The interval from the finish time of the last execution to the [next_start][next-start].                                     | ✖        | Set the time this job is first run. This is also the time that `next_start` is calculated from. |
| `next_start`                  |TIMESTAMPTZ| -|  ✖       | Set the start time of the next immediate execution. It does not change the computation of the next scheduled time after the next execution.  |
| `timezone`                    |TEXT| UTC. However, daylight savings time(DST) changes may shift this alignment.                                                   | ✖        | Set to a valid time zone to mitigate DST shifting. If `initial_start` is set, subsequent executions of this policy are aligned on `initial_start`.                                                                                                                                                                                                                                                                                                                         |
| `if_not_exists`               |BOOLEAN| `false`                                                                                                                      | ✖        | Set to `true` so this job fails with a warning rather than an error if a {COLUMNSTORE} policy already exists on `hypertable`                                                                                                                                                                                                                                                                                                                                                |

[compression_alter-table]: /api-reference/timescaledb/hypercore/alter_table/
[compression_continuous-aggregate]: /api-reference/timescaledb/continuous-aggregates/alter_materialized_view/
[set_integer_now_func]: /api-reference/timescaledb/hypertable/set_integer_now_func
[informational-views]: /api-reference/timescaledb/informational-views/jobs/
[chunk_time_interval]: /api-reference/timescaledb/hypertable/set_chunk_time_interval/
[next-start]: /api-reference/timescaledb/informational-views/jobs/#arguments
[job]: /api-reference/timescaledb/jobs-automation/add_job/
[remove_columnstore_policy]: /api-reference/timescaledb/hypercore/remove_columnstore_policy/
[hypertables-section]: /manage-data/timescaledb/data-management/hypertables
[hypertable-create-table]: /api-reference/timescaledb/hypertable/create_table/
[hypercore]: /manage-data/timescaledb/data-management/hypercore/
[secondary-indexes]: /manage-data/timescaledb/data-management/hypercore/secondary-indexes/
[bloom-filters]: https://en.wikipedia.org/wiki/Bloom_filter
[create_table_arguments]: /api-reference/timescaledb/hypertable/create_table/#arguments
[alter_job_samples]: /api-reference/timescaledb/jobs-automation/alter_job/#samples
[add_columnstore_policy]: /api-reference/timescaledb/hypercore/add_columnstore_policy/
[tsdb-release-2-19-3]: https://github.com/timescale/timescaledb/releases/tag/2.19.3
